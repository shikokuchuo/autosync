% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/server.R
\name{amsync_server}
\alias{amsync_server}
\title{Create an Automerge sync server}
\usage{
amsync_server(
  port = 3030L,
  host = "127.0.0.1",
  data_dir = ".automerge",
  auto_create_docs = TRUE,
  storage_id = NULL,
  tls = NULL,
  auth = NULL
)
}
\arguments{
\item{port}{Port to listen on. Default 3030.}

\item{host}{Host address to bind to. Default "127.0.0.1" (localhost).}

\item{data_dir}{Directory for persistent document storage. Default ".automerge".}

\item{auto_create_docs}{Logical, whether to auto-create documents when
clients request unknown document IDs. Default TRUE.}

\item{storage_id}{Optional storage ID for this server. If NULL (default),
generates a new persistent identity. Set to NA for an ephemeral server
(no persistence identity).}

\item{tls}{(optional) for secure wss:// connections, a TLS configuration
object created by \code{\link[nanonext:tls_config]{nanonext::tls_config()}}.}

\item{auth}{Optional authentication configuration created by \code{\link[=auth_config]{auth_config()}}.
When provided, clients must include a valid OAuth2 access token
in their join message's peerMetadata. Requires the gargle package.
Note: TLS is required when authentication is enabled to protect tokens.}
}
\value{
An amsync_server object inheriting from 'nanoServer', with
\verb{$start()} and \verb{$close()} methods.
}
\description{
Creates a WebSocket server that implements the automerge-repo sync protocol,
compatible with JavaScript, Rust, and other Automerge clients.
}
\details{
The returned server inherits from nanonext's nanoServer class and provides
\verb{$start()} and \verb{$close()} methods for non-blocking operation.
}
\examples{
\dontshow{if (interactive()) withAutoprint(\{ # examplesIf}
# Create and start a server
server <- amsync_server()
server$start()

# Server is now running in the background
# ...do other work...

# Stop when done
server$close()

# Custom port with TLS
cert <- nanonext::write_cert()
tls <- nanonext::tls_config(server = cert$server)
server <- amsync_server(port = 8080, tls = tls)
server$start()
server$close()

# Server with Google OAuth authentication (requires TLS)
cert <- nanonext::write_cert()
tls <- nanonext::tls_config(server = cert$server)
server <- amsync_server(
  port = 3030,
  tls = tls,
  auth = auth_config(allowed_domains = c("mycompany.com"))
)
\dontshow{\}) # examplesIf}
}
